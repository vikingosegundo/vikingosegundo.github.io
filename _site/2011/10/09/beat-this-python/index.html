<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Manuel Meyer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">

  <link href="/stylesheets/more.css" rel="stylesheet">
  <link href="/stylesheets/syntax.css" rel="stylesheet">
</head>

<body>
  <div id="header">
    <a href="/"><div class="avatar">&nbsp;</div></a>
      <div class="personal-details">
        <a href="/"><h1>Manuel Meyer</h1></a>
        <p>
          Software Engineer
        </p>
        <ul>
          <li><a href="http://stackoverflow.com/users/106435/vikingosegundo">stackoverflow</a></li>
          <li><a href="http://github.com/vikingosegundo">github</a></li>
          <li><a href="http://twitter.com/vikingosegundo">twitter</a></li>
        </ul>
      </div>
  </div>

  <div class="container">

<div id="content">

<div class="row-fluid">
  <div class="span8">
    <h1>Beat This, Python!</h1>

    <p><strong>I love Python. I love Objective-C.</strong></p>

<p>"Huh?!" I hear you thinking, "they are complete different, how can you like both"?</p>

<p>Well, nothing is perfect, even in a lovely relationship.
There are things, that drive me crazy in one — and things that are missing, form my point of view, in the other language</p>

<p>One thing I'd love to see in Python, that Objective-C has, is extending a class — Categories.
Every language should have functional tools like pythons List Comprehensions, but Objective-C hasn't.</p>

<p>But since Apple extended Objective-C by introducing Blocks to the underlaying C, it is now possible to have something similar to List Comprehensions — and this article is about how.
When people ask me, why I am such a big fan of Python, I usually refer to a sample Quicksort algorithm using List Comprehensions.
here we go:</p>

<pre><code class="python">
def quicksort(alist):
  if len(alist) &lt;= 1: return alist
    pivotelement = alist.pop()
    left  = [element for element in alist if element &lt; pivotelement]
    right = [element for element in alist if element &gt;= pivotelement]
  return quicksort(left) + [pivotelement] + quicksort(right)
</code></pre>

<p>  <!--break--></p>

<p>Compact and beautiful, isn't it?</p>

<p>But wait, there is a down-side in it:</p>

<p>With every recursive call of quicksort() we iterate over alist twice: Once to filter for smaller, once to filter for greater elements. With an average performance of O(n log n) this can be problematic for big lists.</p>

<p>But why do we iterate over alist twice? Can't we just say "…if less than pivot do… else do"?. We can — but not with List Comprehensions. For a very simple reason: They don't feature else-statements. And how could they? What need to be done in a else-clause is not predictable in such a language-level. Would we fill another array always? Do we want to be notified, if a else case is true? There are many cases the language architect cannot predict. One thing that actually could be done is to call a callback or a lambda with the element that raises the else case.</p>

<p>And that is exactly how I did my Objective-C array tools.
Have a look at this signature:</p>

<pre><code class="objc">- (NSArray *) arrayByPerformingBlock:(id   (^)(id element))performBlock
                 ifElementPassesTest:(BOOL (^)(id element))testBlock
                    elsePerformBlock:(void (^)(id element))elseBlock;
</code></pre>

<p>If the testBlock returns YES, the element will be processed in the performBlock and returned
If the test fails the elseBlock will be executed with the element.</p>

<p>How would the initial example look like?</p>

<pre><code class="objc">
NSArray* quicksort(NSArray *array)
{
    if ([array count]&lt;2) return array;
    id pivot = [array randomElement];
    NSMutableArray *array2= [NSMutableArray array];
    array = [array arrayByPerformingBlock:^id  (id element) { return element;}
                      ifElementPassesTest:^BOOL(id element) { return [element intValue] &lt; [pivot intValue];}
                         elsePerformBlock:^    (id element) { if (element!=pivot) [array2 addObject:element];}
    ];
    return [[quicksort(array) arrayByAddingObject:pivot] arrayByAddingObjectsFromArray:quicksort(array2)];}
</code></pre>

<p>Not bad, huh?</p>

<p>Well, I mentioned in the beginning, that I like Categories, so lets do the last step and transform this C-style function into a Category.</p>

<pre><code class="objc">
-(NSArray *) quicksort
{
    if ([self count]&lt;2) return self;

    id pivot = [self randomElement];
    NSMutableArray *array2= [NSMutableArray array];

    self = [self arrayByPerformingBlock:^id(id element)   { return element;}
                      ifElementPassesTest:^BOOL(id element) { return [element intValue] &lt; [pivot intValue];}
                         elsePerformBlock:^    (id element) { if (element!=pivot) [array2 addObject:element];}
    ];
    return [[[self quicksort] arrayByAddingObject:pivot] arrayByAddingObjectsFromArray:[array2 quicksort]];
}
</code></pre>

<p>You may ask "How is that Quicksort implementation useful to me?" It isn't. It is just an example. Please do sorting with the APIs offered by Apple. I am pretty sure, that they are much better.
But If you a requirement where you need to filter a array in maybe two arrays, you can do this:</p>

<pre><code class="objc">NSMutableArray *falsePositives = [NSMutableArray array];
NSArray *array = [NSArray arrayWithObjects:@"aa", @"ab",@"c",@"ad",@"dd", nil];
array = [array arrayByPerformingBlock:^id  (id element) {return [element stringByAppendingString:element];}
                  ifElementPassesTest:^BOOL(id element) {return [element hasPrefix:@"a"];}
                     elsePerformBlock:^    (id element) {[falsePositives addObject:element];}];
</code></pre>

<p>You see I use block to active a more functional programming style and to emulate List Comprehensions. But I go a bit further and introduce a else-clause. <strong>Beat This, Python!</strong></p>

<pre><code class="objc">
#import &lt;Foundation/Foundation.h&gt;

@interface NSArray (FunctionalTools)
-(NSArray *) filter:(BOOL(^)(id element))filterBlock;

+(NSArray *) arrayByPerformingBlock:(id(^)(NSInteger index))performBlock
                withIndexFromRange:(NSRange)range;

-(NSArray *) arrayByPerformingBlock:(id  (^)(id element))performBlock;

-(NSArray *) arrayByPerformingBlock:(id  (^)(id element))performBlock
                ifElementPassesTest:(BOOL(^)(id element))testBlock;

-(NSArray *) arrayByPerformingBlock:(id   (^)(id element))performBlock
                ifElementPassesTest:(BOOL (^)(id element))testBlock
                   elsePerformBlock:(void (^)(id element))elseBlock;

-(NSArray *) arrayByPerformingBlock:(id   (^)(id element))performBlock
                ifElementPassesTest:(BOOL (^)(id element))testBlock
                   elsePerformBlock:(void (^)(id element))elseBlock
                           succeded:(void (^) ())succesBlock
                             failed:(void (^)(id element))failedBlock
                   stopOnFailedTest:(BOOL)stop;


-(void)performBlock:(void (^) (id element))block;
@end
</code></pre>

<pre><code class="objc">#import "NSArray+FunctionalTools.h"

@implementation NSArray (FunctionalTools)
-(NSArray *) filter:(BOOL (^)(id))filterBlock
{
    NSMutableArray *filteredArray = [NSMutableArray array];
    for (id element in self)
        if (filterBlock(element))
            [filteredArray addObject:element];
    return [NSArray arrayWithArray:filteredArray];
}

+(NSArray *) arrayByPerformingBlock:(id (^)(NSInteger))performBlock withIndexFromRange:(NSRange)range
{
    NSMutableArray *array = [NSMutableArray array];
    for (NSUInteger i = range.location; i&lt; range.location+range.length; ++i) {
        [array addObject:performBlock(i)];
    }
    return array;
}
-(NSArray *) arrayByPerformingBlock:(id  (^)(id element))performBlock
{
    return [self arrayByPerformingBlock:performBlock
                    ifElementPassesTest:^BOOL(id element) { return  YES;}];
}

-(NSArray *) arrayByPerformingBlock:(id(^)(id element))performBlock
                       ifElementPassesTest:(BOOL(^)(id element))testBlock
{

    return [self arrayByPerformingBlock:performBlock
                    ifElementPassesTest:testBlock
                       elsePerformBlock:^(id element){;}];
}

-(NSArray *) arrayByPerformingBlock:(id (^)(id))performBlock
           ifElementPassesTest:(BOOL (^)(id))testBlock
              elsePerformBlock:(void (^)(id))elseBlock
{
    NSMutableArray *array = [NSMutableArray array];
    for (id element in self)
        if(testBlock(element))
            [array addObject:performBlock(element)];
        else
            elseBlock(element);
    return array;
}


-(NSArray *) arrayByPerformingBlock:(id   (^)(id element))performBlock
                ifElementPassesTest:(BOOL (^)(id element))testBlock
                   elsePerformBlock:(void (^)(id element))elseBlock
                           succeded:(void (^)())succesBlock
                             failed:(void (^)(id element))failedBlock
                   stopOnFailedTest:(BOOL)stop

{
    NSMutableArray *array = [NSMutableArray array];
    for (id element in self){
        if(testBlock(element))
            [array addObject:performBlock(element)];
        else{
            elseBlock(element);
            if (stop) {
                failedBlock(element);
                break;
            }
        }
    }

    if (!stop) {
        succesBlock();
    }


    return array;

}

-(void) performBlock:(void (^)(id))block
{
    for(id element in self) {
        block(element);
    }
}

@end
</code></pre>

  </div>
  <div class="span4">
  </div>

  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'vikingosegundo'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  
</div>
</div>
</div>
</body>
</html>

